<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>深度學習實作心得01-花品種辨識 | Anyapoi WebSite</title>
  
  
  
  <!--link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css"-->
  
<link rel="stylesheet" href="//cdn.jsdelivr.net/highlight.js/9.10.0/styles/github-gist.min.css">

  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
<div class="Shell">
    <aside class='SideBar'>
    <section class='avatar' style="background-image: url()">
        <div class='av-pic' style="background-image: url()">
        </div>
    </section>
    <section class='menu'>
        <div>Anyapoi WebSite</div>
        
            <div>poi</div>
        
        <ul>
          
            <a href="/" class="Btn">
              <li>Home</li>
            </a>  
          
            <a href="/archives/" class="Btn">
              <li>Archive</li>
            </a>  
          
            <a href="/tags/" class="Btn">
              <li>Tags</li>
            </a>  
          
            <a href="/categories/" class="Btn">
              <li>Categories</li>
            </a>  
          
            <a href="/about/" class="Btn">
              <li>About</li>
            </a>  
          
            <a href="https://i.imgur.com/cjGoQtg.jpg" target="_blank" rel="noopener" class="Btn">
              <li>avatar</li>
            </a>  
          
        </ul>
    </section>
    <section class="media">
        
            
                <a href="https://github.com/chenchianstudent" target="_blank" rel="noopener">
                    <img src="/assets/github.svg" />
                </a>
            
        
            
                <a href="https://www.facebook.com/profile.php?id=100004713881642" target="_blank" rel="noopener">
                    <img src="/assets/facebook.svg" />
                </a>
            
        
    </section>
</aside>

    <div class="container">
        <div data-pager-shell>
            <div>
  <article class='ContentView'>
    <header class='PageTitle'>
        <h1>深度學習實作心得01-花品種辨識</h1>
    </header>

    <section>
      <h2 id="為什麼會有這篇文章"><a href="#為什麼會有這篇文章" class="headerlink" title="為什麼會有這篇文章?"></a>為什麼會有這篇文章?</h2><p>記錄我在研究所學習深度學習的知識與心得。</p>
<h2 id="這篇文章做什麼用的"><a href="#這篇文章做什麼用的" class="headerlink" title="這篇文章做什麼用的?"></a>這篇文章做什麼用的?</h2><p>這篇文章為<a href="https://chenchianstudent.github.io/2020/09/08/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E7%9A%84Hello_World-%E6%89%8B%E5%AF%AB%E6%95%B8%E5%AD%97%E8%BE%A8%E8%AD%98/" target="_blank" rel="noopener">深度學習的Hello World-手寫數字辨識</a>的延伸實作，目的是透過一系列的實作心得，來帶給閱讀者怎麼使用tensorflow進行深度學習。<br>上次的文章資料使用Mnist，是函式庫裡面就有且處理好的資料，因此在資料處理這塊沒辦法深入太多，而這次主要是希望集中在資料處理這方面的實作解說，起碼不會讓你只能做Mnist的辨識而已，更可以應用在其他東西上。</p>
<h2 id="前置步驟-amp-注意事項"><a href="#前置步驟-amp-注意事項" class="headerlink" title="前置步驟&amp;注意事項"></a>前置步驟&amp;注意事項</h2><ol>
<li>本心得教學是使用tensorflow來進行撰寫。怎麼裝tensorflow？我有另外寫了<a href="https://chenchianstudent.github.io/2020/06/01/%E5%9C%A8Anaconda%E5%AE%89%E8%A3%9DTensorflow2-0%E7%89%88%E6%9C%AC-GPU%E7%89%88%E6%9C%AC%E7%AF%87/" target="_blank" rel="noopener">文章</a>。</li>
<li>我必須強調一下，本人在寫這篇文章時還是學習中的學生，算是初心者。內容若是有錯，誤導大家還請多多包涵！之後發現我自己有說錯的話，也會去重新修文章，你發現我有說錯的話，也請告訴我哪裡錯了。</li>
<li>本文章為深度學習實作心得的系列文章，此篇為第一集，如果沒有看過第0集的話，希望你先看完第0集再來觀看此文章。</li>
<li>模型訓練的過程中，有些參數若是照我的內容抄，結果執行時會噴錯，原因很有可能是設備的性能造成的。我的指導老師說了一句我覺得蠻中肯的話:深度學習也是一種軍備競賽，裝備差的人能表現的實在有限。</li>
<li>若是範例在jupyter notebook上跑不動，可以採用colab。<br>colab是google發明類似jupyter notebook的程式編譯器，是online的，有網路就可以在瀏覽器上使用，有興趣可以試試，目前是免費的，但不保證未來也是免費喔！</li>
</ol>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>當Mnist資料集的範例程式了解後，想必第一個念頭就是能不能應用在其他的辨識上？<br>答案是能的！一定可以！深度學習不單單用在手寫數字辨識上，生活上各種辨識很多都能透過深度學習去進行辨識，但是我要怎麼把範例程式改成其他資料呢？<br>其實透過上篇文章的範例程式進行添加與修飾，就可以進行其他資料的辨識，不會太艱深，真的就是範例程式碼的變化而已。</p>
<h2 id="了解資料內容-花的品種"><a href="#了解資料內容-花的品種" class="headerlink" title="了解資料內容-花的品種"></a>了解資料內容-花的品種</h2><p>這是kaggle一個蠻早期的辨識題目，目的是讓機器辨識各種花的品種，品種有’daisy’, ‘dandelion’, ‘rose’, ‘sunflower’, ‘tulip’。乍看下差異有點大，人去辨識就很直接的出結果，沒有什麼挑戰性。但這份資料蠻適合新手第一次的練習，原因是資料量滿夠的，每個品種至少有700張以上，幫你省去了資料收集的動作，而且這個資料量可以更接近確切數據的，不會因為資料量少而導致容易overfitting，真心推薦各位使用這份資料。</p>
<h2 id="了解資料形式"><a href="#了解資料形式" class="headerlink" title="了解資料形式"></a>了解資料形式</h2><p>在研究深度學習時，我經常把程序分成好幾個部分。<br>程序如下：<br><strong>資料處理 –&gt; 模型建置 –&gt; 模型訓練 –&gt; 模型評估 –&gt; 模型儲存</strong></p>
<p>這是我個人分出來的大項，每一項都能拿出來當一個主題細講，內容多到不行。<br>就如前面提到的，今天我要說明資料處理的一些重點，因為一切的開頭都是從資料開始進行的，不先說明就沒辦法做接下來的流程，偏偏很多網路文章都不喜歡講資料處理這塊，我不知道是太懶還是把閱讀者都當萬事通，明明這麼重要的東西，撰寫者就丟個程式碼說這是我的訓練資料製作就沒了，連個說明都沒有，這誰看的懂阿！</p>
<p>回到正題，在進行資料處理前，必須要知道資料是長什麼樣子的。<br>一般在網路上拿到的資料，都會處理成下面兩大形式：</p>
<ol>
<li>用各自類別命名的單獨資料夾中的所有圖像，A標籤的圖片全部集中在同一個資料夾中，以此類推。</li>
<li>所有圖像都存在於一個目錄中，並將圖片名稱與對應標籤寫入一個CSV或JSON文件中。</li>
</ol>
<p>我目前也只有遇到這兩大形式，這兩種形式在資料處理的時候，會有很大不同的寫法，甚至是資料增強使用的函數也會有所不同！<br>本次的資料形式是屬於第一類型，資料夾的名稱就是花的品種，資料夾內也會有對應的花圖片。</p>
<img src="/2020/09/24/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E5%AF%A6%E4%BD%9C%E5%BF%83%E5%BE%9701-%E8%8A%B1%E5%93%81%E7%A8%AE%E8%BE%A8%E8%AD%98/pc02.jpg" class="" title="This is an image">
<p>這個環節很重要喔！判斷是哪種形式也是資料處理中很重要的一環，儘管這看起來非常簡單，特意寫出來怎麼判斷感覺很蠢，但這就是開頭。</p>
<h2 id="GitHub"><a href="#GitHub" class="headerlink" title="GitHub"></a>GitHub</h2><p>本文章對應的github專案，內容全是我自己寫的，歡迎大家參考，也請查看專案的 readme.md ，它會教你怎麼使用。<br>網址：<a href="https://github.com/chenchianstudent/DeepLearning_FlowerSpecies_Identification" target="_blank" rel="noopener">https://github.com/chenchianstudent/DeepLearning_FlowerSpecies_Identification</a></p>
<h2 id="實作心得"><a href="#實作心得" class="headerlink" title="實作心得"></a>實作心得</h2><h3 id="程式碼"><a href="#程式碼" class="headerlink" title="程式碼"></a>程式碼</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">print(tf.__version__)</span><br><span class="line">print(<span class="string">"本次測試標籤為:"</span>,os.listdir(<span class="string">'C:/Users/danie/flowers'</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> cv2                  </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm                </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">X=[]</span><br><span class="line">Z=[]</span><br><span class="line">IMG_SIZE=<span class="number">224</span></span><br><span class="line">FLOWER_DAISY_DIR=<span class="string">'C:/Users/danie/flowers/daisy'</span></span><br><span class="line">FLOWER_SUNFLOWER_DIR=<span class="string">'C:/Users/danie/flowers/sunflower'</span></span><br><span class="line">FLOWER_TULIP_DIR=<span class="string">'C:/Users/danie/flowers/tulip'</span></span><br><span class="line">FLOWER_DANDI_DIR=<span class="string">'C:/Users/danie/flowers/dandelion'</span></span><br><span class="line">FLOWER_ROSE_DIR=<span class="string">'C:/Users/danie/flowers/rose'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assign_label</span><span class="params">(img,flower_type)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> flower_type</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_train_data</span><span class="params">(flower_type,DIR)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> img <span class="keyword">in</span> tqdm(os.listdir(DIR)):</span><br><span class="line">        label=assign_label(img,flower_type)</span><br><span class="line">        path = os.path.join(DIR,img)</span><br><span class="line">        img = cv2.imread(path,cv2.IMREAD_COLOR)</span><br><span class="line">        img = cv2.resize(img, (IMG_SIZE,IMG_SIZE))</span><br><span class="line">        </span><br><span class="line">        X.append(np.array(img))</span><br><span class="line">        Z.append(str(label))</span><br><span class="line">        </span><br><span class="line">make_train_data(<span class="string">'Daisy'</span>,FLOWER_DAISY_DIR)</span><br><span class="line">print(<span class="string">"Daisy:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Sunflower'</span>,FLOWER_SUNFLOWER_DIR)</span><br><span class="line">print(<span class="string">"Sunflower:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Tulip'</span>,FLOWER_TULIP_DIR)</span><br><span class="line">print(<span class="string">"Tulip:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Rose'</span>,FLOWER_ROSE_DIR)</span><br><span class="line">print(<span class="string">"Rose:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Dandelion'</span>,FLOWER_DANDI_DIR)</span><br><span class="line">print(<span class="string">"Dandelion:"</span>,len(X))</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> random <span class="keyword">as</span> rn</span><br><span class="line">fig,ax=plt.subplots(<span class="number">5</span>,<span class="number">2</span>)</span><br><span class="line">fig.set_size_inches(<span class="number">15</span>,<span class="number">15</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range (<span class="number">2</span>):</span><br><span class="line">        l=rn.randint(<span class="number">0</span>,len(Z))</span><br><span class="line">        ax[i,j].imshow(X[l])</span><br><span class="line">        ax[i,j].set_title(<span class="string">'Flower: '</span>+Z[l])</span><br><span class="line">        </span><br><span class="line">plt.tight_layout()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> keras.utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">le=LabelEncoder()</span><br><span class="line">Y=le.fit_transform(Z)</span><br><span class="line">Y=to_categorical(Y,<span class="number">5</span>)</span><br><span class="line">X=np.array(X)</span><br><span class="line">print(type(X))</span><br><span class="line">print(X.shape)</span><br><span class="line">print(len(X))</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">42</span>)</span><br><span class="line">rn.seed(<span class="number">42</span>)</span><br><span class="line">tf.set_random_seed(<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line">X=X/<span class="number">255</span></span><br><span class="line"></span><br><span class="line">x_train,x_test,y_train,y_test=train_test_split(X,Y,test_size=<span class="number">0.25</span>,random_state=<span class="number">42</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.layers.core <span class="keyword">import</span> Dense, Dropout, Activation, Flatten</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.utils <span class="keyword">import</span> np_utils</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> Adam,SGD,Adagrad,Adadelta,RMSprop</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.layers <span class="keyword">import</span> Conv2D, MaxPooling2D</span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Conv2D(filters = <span class="number">32</span>, kernel_size = (<span class="number">5</span>,<span class="number">5</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>, input_shape = (<span class="number">224</span>,<span class="number">224</span>,<span class="number">3</span>)))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model.add(Conv2D(filters = <span class="number">64</span>, kernel_size = (<span class="number">3</span>,<span class="number">3</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>), strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">model.add(Conv2D(filters =<span class="number">96</span>, kernel_size = (<span class="number">3</span>,<span class="number">3</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>), strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(Conv2D(filters = <span class="number">96</span>, kernel_size = (<span class="number">3</span>,<span class="number">3</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>), strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">512</span>))</span><br><span class="line">model.add(Activation(<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dense(<span class="number">5</span>, activation = <span class="string">"softmax"</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model.compile(optimizer=<span class="string">'adam'</span>,loss=<span class="string">'categorical_crossentropy'</span>,metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> keras.callbacks <span class="keyword">import</span> ReduceLROnPlateau</span><br><span class="line">red_lr= ReduceLROnPlateau(monitor=<span class="string">'val_acc'</span>,patience=<span class="number">3</span>,verbose=<span class="number">1</span>,factor=<span class="number">0.1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line">datagen = ImageDataGenerator(</span><br><span class="line">        featurewise_center=<span class="literal">False</span>,  <span class="comment"># set input mean to 0 over the dataset</span></span><br><span class="line">        samplewise_center=<span class="literal">False</span>,  <span class="comment"># set each sample mean to 0</span></span><br><span class="line">        featurewise_std_normalization=<span class="literal">False</span>,  <span class="comment"># divide inputs by std of the dataset</span></span><br><span class="line">        samplewise_std_normalization=<span class="literal">False</span>,  <span class="comment"># divide each input by its std</span></span><br><span class="line">        zca_whitening=<span class="literal">False</span>,  <span class="comment"># apply ZCA whitening</span></span><br><span class="line">        rotation_range=<span class="number">10</span>,  <span class="comment"># randomly rotate images in the range (degrees, 0 to 180)</span></span><br><span class="line">        zoom_range = <span class="number">0.1</span>, <span class="comment"># Randomly zoom image </span></span><br><span class="line">        width_shift_range=<span class="number">0.2</span>,  <span class="comment"># randomly shift images horizontally (fraction of total width)</span></span><br><span class="line">        height_shift_range=<span class="number">0.2</span>,  <span class="comment"># randomly shift images vertically (fraction of total height)</span></span><br><span class="line">        horizontal_flip=<span class="literal">True</span>,  <span class="comment"># randomly flip images</span></span><br><span class="line">        vertical_flip=<span class="literal">False</span>)  <span class="comment"># randomly flip images</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datagen.fit(x_train)</span><br><span class="line"></span><br><span class="line">History = model.fit(x_train,</span><br><span class="line">                    y_train, </span><br><span class="line">                    batch_size=<span class="number">20</span>,</span><br><span class="line">                    epochs = <span class="number">10</span>, </span><br><span class="line">                    validation_data = (x_test,y_test),</span><br><span class="line">                    verbose = <span class="number">1</span>,</span><br><span class="line">                    <span class="comment">#callbacks = red_lr</span></span><br><span class="line">                   )</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_learning_curves</span><span class="params">(History)</span>:</span></span><br><span class="line">    pd.DataFrame(History.history).plot(figsize=(<span class="number">8</span>,<span class="number">5</span>))</span><br><span class="line">    plt.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.gca().set_ylim(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line">plot_learning_curves(History)</span><br></pre></td></tr></table></figure>
<p>大…大哥！你不是說只是範例程式碼的變化而已嗎？範例程式也才15行左右，怎麼瞬間迸出了這麼多行！？我是不是上賊船了？？<br>冷…冷靜！真的只是變化而已，只是我不小心寫多了！有些小技巧想告訴大家，因此多了些函數，另外資料處理這塊應該是多最多行的，原因是之前的Mnist資料集在import進來時就處理好了，你只要呼叫就好，這次則是要重新處理，所以才會比較多。</p>
<p>一樣我會分段進行解釋，但是上一篇我有說過的東西會草草帶過，因為重新解釋的話，會多很多不必要的廢話，導致文章過長。</p>
<h3 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">print(tf.__version__)</span><br><span class="line">print(<span class="string">"本次測試標籤為:"</span>,os.listdir(<span class="string">'C:/Users/danie/flowers'</span>))</span><br></pre></td></tr></table></figure>
<p>很簡單的確認版本程式碼。<br>這次我多import了os這個函式庫，目的是來抓取本地資料，因為這次主題就是用手上的資料。<br><code>print(os.listdir(&#39;欲輸入的位置&#39;))</code>用來查看這個位置有什麼資料夾的名稱，也算是另類的標籤類別確認。</p>
<p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1.14.0</span><br><span class="line">本次測試標籤為: [&#39;daisy&#39;, &#39;dandelion&#39;, &#39;rose&#39;, &#39;sunflower&#39;, &#39;tulip&#39;]</span><br></pre></td></tr></table></figure>
<h3 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cv2                  </span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np  </span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm               </span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle  </span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"></span><br><span class="line">X=[]</span><br><span class="line">Z=[]</span><br><span class="line">IMG_SIZE=<span class="number">224</span></span><br><span class="line">FLOWER_DAISY_DIR=<span class="string">'C:/Users/danie/flowers/daisy'</span></span><br><span class="line">FLOWER_SUNFLOWER_DIR=<span class="string">'C:/Users/danie/flowers/sunflower'</span></span><br><span class="line">FLOWER_TULIP_DIR=<span class="string">'C:/Users/danie/flowers/tulip'</span></span><br><span class="line">FLOWER_DANDI_DIR=<span class="string">'C:/Users/danie/flowers/dandelion'</span></span><br><span class="line">FLOWER_ROSE_DIR=<span class="string">'C:/Users/danie/flowers/rose'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assign_label</span><span class="params">(img,flower_type)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> flower_type</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">make_train_data</span><span class="params">(flower_type,DIR)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> img <span class="keyword">in</span> tqdm(os.listdir(DIR)):</span><br><span class="line">        label=assign_label(img,flower_type)</span><br><span class="line">        path = os.path.join(DIR,img)</span><br><span class="line">        img = cv2.imread(path,cv2.IMREAD_COLOR)</span><br><span class="line">        img = cv2.resize(img, (IMG_SIZE,IMG_SIZE))</span><br><span class="line">        </span><br><span class="line">        X.append(np.array(img))</span><br><span class="line">        Z.append(str(label))</span><br></pre></td></tr></table></figure>
<p>import的部分我稍稍提一下就好，基本上在做深度學習的時候，有幾個函式庫很常import進來，比如cv2和numpy。</p>
<ul>
<li>tqdm：可以在 Python 長迴圈中新增進度提示資訊，讓你有個進度條確認。</li>
<li>numpy：一個開源的python科學計算函式庫，許多常見有名的科學計算函式庫都會用上Numpy的一些功能，例如Pandas、Scikit-learn等。簡言之：很常用！  但因為要細講可以寫一篇文章，因此我這邊簡略說明。</li>
<li>cv2：全名叫openCV，程式撰寫時簡稱cv2。cv2專門處理圖像的函式庫，在深度學習中，與Numpy很常在組合進行撰寫。</li>
<li>PIL：python中比較有名的影像處理套件，可以用來轉檔、調色、濾鏡、浮水印甚至創造圖等功能，而且可以批次處理大量的檔案。</li>
</ul>
<p><code>X=[]
Z=[]</code>宣告這兩個陣列是用來儲存圖片資料和標籤類別的。<br><code>IMG_SIZE</code>則是圖片大小的設定<br>剩下的<code>FLOWER_XXXXX_DIR</code>是紀錄花的各品種圖片資料夾位置，注意不用在最後面加上”/“。</p>
<p>這裡我宣告了兩個函式”assign_label”和”make_train_data”。<br>assign_label是用來返回花品種的，等等用在make_train_data這個函式裡，因為花不是只有一種，然後make_train_data函式會用在所有的品種處裡上，故無法寫死品種這一塊，這時就需要靠assign_label函式來判斷這個圖片屬於哪種品種。</p>
<p>make_train_data用來製作訓練資料的函式，首先我們要輸入花品種和該品種的圖片資料夾位置，接著就會將資料夾裡的圖片依序抓出來做處裡(調整大小、資料型態轉numpy等…)，最後圖片資料加入X陣列，而標籤類別則加進Y陣列。</p>
<h3 id="第三部分"><a href="#第三部分" class="headerlink" title="第三部分"></a>第三部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">make_train_data(<span class="string">'Daisy'</span>,FLOWER_DAISY_DIR)</span><br><span class="line">print(<span class="string">"Daisy:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Sunflower'</span>,FLOWER_SUNFLOWER_DIR)</span><br><span class="line">print(<span class="string">"Sunflower:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Tulip'</span>,FLOWER_TULIP_DIR)</span><br><span class="line">print(<span class="string">"Tulip:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Rose'</span>,FLOWER_ROSE_DIR)</span><br><span class="line">print(<span class="string">"Rose:"</span>,len(X))</span><br><span class="line"></span><br><span class="line">make_train_data(<span class="string">'Dandelion'</span>,FLOWER_DANDI_DIR)</span><br><span class="line">print(<span class="string">"Dandelion:"</span>,len(X))</span><br></pre></td></tr></table></figure>
<p>這一段就是直接對每種品種進行訓練資料的處理，用的是第二部分<code>make_train_data</code>函式。<br>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">100%|███████████████████████████████████████████████████████████████████████████████| 984&#x2F;984 [00:06&lt;00:00, 142.48it&#x2F;s]</span><br><span class="line">Tulip: 2487</span><br></pre></td></tr></table></figure>
<p>我拿其中一段做展示，出現進度條原因是我在make_train_data函式裡有用上tqdm，讓你的output帥一點。</p>
<h3 id="第四部份"><a href="#第四部份" class="headerlink" title="第四部份"></a>第四部份</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> random <span class="keyword">as</span> rn</span><br><span class="line">fig,ax=plt.subplots(<span class="number">5</span>,<span class="number">2</span>)</span><br><span class="line">fig.set_size_inches(<span class="number">15</span>,<span class="number">15</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range (<span class="number">2</span>):</span><br><span class="line">        l=rn.randint(<span class="number">0</span>,len(Z))</span><br><span class="line">        ax[i,j].imshow(X[l])</span><br><span class="line">        ax[i,j].set_title(<span class="string">'Flower: '</span>+Z[l])</span><br><span class="line">        </span><br><span class="line">plt.tight_layout()</span><br></pre></td></tr></table></figure>
<p>這段程式碼是用來確認和一些圖片呈現的小技術，對深度學習訓練本身沒有甚麼大影響。<br>先給各位看output比較明白：</p>
<img src="/2020/09/24/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E5%AF%A6%E4%BD%9C%E5%BF%83%E5%BE%9701-%E8%8A%B1%E5%93%81%E7%A8%AE%E8%BE%A8%E8%AD%98/pc01.JPG" class="" title="This is an image">

<p><code>fig,ax=plt.subplots(5,2)</code>顯告output要以怎樣的形式呈現(列，行)，像上面的output呈現不是一行2張嗎？就是在這裡設定的。而5列因為截圖關係，我只截到3列，正確的output會是5列，這點請多多包涵，總之概念有傳達到。<br><code>fig.set_size_inches(15,15)</code>則是output時，每張圖片呈現的大小，跟之前我們對圖片做的resize不同喔！之前做的是模型讀入時的調整大小，而這裡純粹是在jupyter notebook上output時的大小調整，實質上對圖片沒有任何修改。</p>
<p>接下來的for迴圈我應該不用說明吧？很簡單的邏輯，因為我們的列行設定5跟2，所以for迴圈的i和j設定就是5和2。<br>剩下就是圖片呈現出來的設定，圖片抓取是靠亂數抓去，因此每次抓取都會是不同的圖片，這段多RUN幾次大概就知道了。</p>
<p>最後就是靠<code>plt.tight_layout()</code>output出來。</p>
<h3 id="第五部分"><a href="#第五部分" class="headerlink" title="第五部分"></a>第五部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sklearn.preprocessing <span class="keyword">import</span> LabelEncoder</span><br><span class="line"><span class="keyword">from</span> keras.utils <span class="keyword">import</span> to_categorical</span><br><span class="line"><span class="keyword">from</span> sklearn.model_selection <span class="keyword">import</span> train_test_split</span><br><span class="line"></span><br><span class="line">le=LabelEncoder()</span><br><span class="line">Y=le.fit_transform(Z)</span><br><span class="line">Y=to_categorical(Y,<span class="number">5</span>)</span><br><span class="line">X=np.array(X)</span><br><span class="line">print(type(X))</span><br><span class="line">print(X.shape)</span><br><span class="line">print(len(X))</span><br></pre></td></tr></table></figure>
<p>這部分偏這次資料處理的重點了。<br>有一個概念是上次沒有遇到的，叫Encoding。<br>這個概念很簡單，假如今天有類別是A、B、C這三種。<br>那Encoding則是將這三種類別轉成陣列0跟1的形式，變成：<br>A —&gt; [ 1 , 0 , 0 ]<br>B —&gt; [ 0 , 1 , 0 ]<br>C —&gt; [ 0 , 0 , 1 ]<br>為什麼要這樣做？因為機器看不懂英文單字或詞。<br>上次Mnist沒這樣做是因為數字辨識的結果就是0-9，是數字，因此不太需要做Encoding。而這次因為辨識結果是英文單詞，所以才需要做這件事情。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">le=LabelEncoder()</span><br><span class="line">Y=le.fit_transform(Z)</span><br><span class="line">Y=to_categorical(Y,<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<p>這裡就是在做Encoding，宣告一個Y將Z陣列放進去，最後再將Y進行Encoding。<br><code>X=np.array(X)</code>是將X陣列的屬性轉乘ndarray形式。<br>到這裡型態處理就告一段了。</p>
<p>如果對這些型態的轉變還是有不少疑慮，不知道到底有沒有轉成功，可以嘗試使用下面程式碼去確認，對比轉換前後的樣子有什麼不同，可能在理解上會有更好的幫助。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">print(type(X)) <span class="comment"># 查看X的型態</span></span><br><span class="line">print(X.shape) <span class="comment"># 查看X的數組大小</span></span><br><span class="line">print(len(X))  <span class="comment"># 查看X的長度</span></span><br><span class="line">print(Y[<span class="number">1</span>]) <span class="comment"># 查看Y陣列第2個位置的內容</span></span><br><span class="line">print(Z[<span class="number">1</span>]) <span class="comment"># 查看Z陣列第2個位置的內容</span></span><br></pre></td></tr></table></figure>
<p>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;class &#39;numpy.ndarray&#39;&gt;</span><br><span class="line">(4323, 224, 224, 3)</span><br><span class="line">(224, 224, 3)</span><br><span class="line">[1. 0. 0. 0. 0.]</span><br><span class="line">Daisy</span><br></pre></td></tr></table></figure>
<p>我只列幾個比較重要的查看方式，不是所有的喔！還請自行變化做判斷。</p>
<h3 id="第六部分"><a href="#第六部分" class="headerlink" title="第六部分"></a>第六部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">np.random.seed(<span class="number">42</span>)</span><br><span class="line">rn.seed(<span class="number">42</span>)</span><br><span class="line">tf.set_random_seed(<span class="number">42</span>)</span><br><span class="line">X=X/<span class="number">255</span></span><br><span class="line">x_train,x_test,y_train,y_test=train_test_split(X,Y,test_size=<span class="number">0.25</span>,random_state=<span class="number">42</span>)</span><br></pre></td></tr></table></figure>
<p><code>X=X/255</code>做歸一化，上次有說明了。<br><code>x_train,x_test,y_train,y_test=train_test_split(X,Y,test_size=0.25,random_state=42)</code>是用來劃分我們剛剛處理好的資料，哪些要當訓練資料、哪些要當驗證資料。<br>上次的文章也有用到類似的程式碼，透過<code>train_test_split()</code>先載入X陣列的圖片和Y陣列的標籤，再用<code>test_size</code>進行劃分。0.25意即X陣列總數的25%當驗證資料。<br>後面有個<code>random_state=42</code>是來隨機抓取圖片的應用，剛剛我們不是設定數量的25%當驗證資料嗎？照理來說，如果沒有加亂數處理，劃分時會按照順序去取比例，加上亂數後，劃分就會變為依比例隨機抓圖片，不會永遠是編號1-75是訓練資料，編號76-100是驗證資料。<br>這樣做有什麼原因嗎？有的喔！如果是直接按照順序劃分的話，會怕機器訓練時讀取圖片，一次都讀到相同類別的圖片，這種狀況機器做辨識時會有 “阿這一塊都是類別A，表示編號<strong>~編號</strong>這段就都會是A類別” 的想法而納入特徵關鍵點，為了避免機器去產生這種想法，所以保險點會加個亂數讓機器去抓圖片。</p>
<h3 id="第七部分"><a href="#第七部分" class="headerlink" title="第七部分"></a>第七部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> tensorflow.python.keras.datasets <span class="keyword">import</span> mnist</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.layers.core <span class="keyword">import</span> Dense, Dropout, Activation, Flatten</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.utils <span class="keyword">import</span> np_utils</span><br><span class="line"><span class="keyword">from</span> keras.optimizers <span class="keyword">import</span> Adam,SGD,Adagrad,Adadelta,RMSprop</span><br><span class="line"><span class="keyword">from</span> tensorflow.python.keras.layers <span class="keyword">import</span> Conv2D, MaxPooling2D</span><br><span class="line">model = Sequential()</span><br><span class="line">model.add(Conv2D(filters = <span class="number">32</span>, kernel_size = (<span class="number">5</span>,<span class="number">5</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>, input_shape = (<span class="number">224</span>,<span class="number">224</span>,<span class="number">3</span>)))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model.add(Conv2D(filters = <span class="number">64</span>, kernel_size = (<span class="number">3</span>,<span class="number">3</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>), strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">model.add(Conv2D(filters =<span class="number">96</span>, kernel_size = (<span class="number">3</span>,<span class="number">3</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>), strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(Conv2D(filters = <span class="number">96</span>, kernel_size = (<span class="number">3</span>,<span class="number">3</span>),padding = <span class="string">'Same'</span>,activation =<span class="string">'relu'</span>))</span><br><span class="line">model.add(MaxPooling2D(pool_size=(<span class="number">2</span>,<span class="number">2</span>), strides=(<span class="number">2</span>,<span class="number">2</span>)))</span><br><span class="line"></span><br><span class="line">model.add(Flatten())</span><br><span class="line">model.add(Dense(<span class="number">512</span>))</span><br><span class="line">model.add(Activation(<span class="string">'relu'</span>))</span><br><span class="line">model.add(Dense(<span class="number">5</span>, activation = <span class="string">"softmax"</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model.compile(optimizer=<span class="string">'adam'</span>,loss=<span class="string">'categorical_crossentropy'</span>,metrics=[<span class="string">'accuracy'</span>])</span><br><span class="line">model.summary()</span><br></pre></td></tr></table></figure>
<p>相信大家都知道這裡在做什麼了，就是模型的建置和函數調整。<br>裡面有幾層是上次文章沒講過的東西。這次我呢……沒有打算講w<br>原因是我打算當下一篇文章的主題，這種模型叫”CNN模型”，是非常有名的深度學習模型。<br>因為太有名，如果CNN草草帶過的話，那就不用學深度學習了。因此這裡就先讓各位知道這是建立模型就好，你可以改成上篇文章的模型也沒關係，一樣都能RUN起來。</p>
<h3 id="第八部分"><a href="#第八部分" class="headerlink" title="第八部分"></a>第八部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> keras.preprocessing.image <span class="keyword">import</span> ImageDataGenerator</span><br><span class="line">datagen = ImageDataGenerator(</span><br><span class="line">        featurewise_center=<span class="literal">False</span>,  <span class="comment"># set input mean to 0 over the dataset</span></span><br><span class="line">        samplewise_center=<span class="literal">False</span>,  <span class="comment"># set each sample mean to 0</span></span><br><span class="line">        featurewise_std_normalization=<span class="literal">False</span>,  <span class="comment"># divide inputs by std of the dataset</span></span><br><span class="line">        samplewise_std_normalization=<span class="literal">False</span>,  <span class="comment"># divide each input by its std</span></span><br><span class="line">        zca_whitening=<span class="literal">False</span>,  <span class="comment"># apply ZCA whitening</span></span><br><span class="line">        rotation_range=<span class="number">10</span>,  <span class="comment"># randomly rotate images in the range (degrees, 0 to 180)</span></span><br><span class="line">        zoom_range = <span class="number">0.1</span>, <span class="comment"># Randomly zoom image </span></span><br><span class="line">        width_shift_range=<span class="number">0.2</span>,  <span class="comment"># randomly shift images horizontally (fraction of total width)</span></span><br><span class="line">        height_shift_range=<span class="number">0.2</span>,  <span class="comment"># randomly shift images vertically (fraction of total height)</span></span><br><span class="line">        horizontal_flip=<span class="literal">True</span>,  <span class="comment"># randomly flip images</span></span><br><span class="line">        vertical_flip=<span class="literal">False</span>)  <span class="comment"># randomly flip images</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">datagen.fit(x_train)</span><br></pre></td></tr></table></figure>
<p>這個部分可以pass掉，這裡的內容偏中期才需要讀的東西，叫”<a href="https://chenchianstudent.github.io/2020/09/21/%E8%B3%87%E6%96%99%E5%A2%9E%E5%BC%B7ImageGenerator-%E4%BD%BF%E7%94%A8%E5%BF%83%E5%BE%97/" target="_blank" rel="noopener">資料增強</a>“。文章我有先寫完了，感興趣的話可以看看！</p>
<h3 id="第九部分"><a href="#第九部分" class="headerlink" title="第九部分"></a>第九部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">History = model.fit(x_train,</span><br><span class="line">                    y_train, </span><br><span class="line">                    batch_size=<span class="number">20</span>,</span><br><span class="line">                    epochs = <span class="number">10</span>, </span><br><span class="line">                    validation_data = (x_test,y_test),</span><br><span class="line">                    verbose = <span class="number">1</span>,</span><br><span class="line">                    <span class="comment">#callbacks = red_lr</span></span><br><span class="line">                   )</span><br></pre></td></tr></table></figure>
<p>模型訓練。<br><code>validation_data = (x_test,y_test)</code>是驗證資料的應用。它會在每一次訓練結束時，用驗證資料去評估這次訓練完成的模型正確率能達到多少。<br>output：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Train on 3242 samples, validate on 1081 samples</span><br><span class="line">Epoch 1&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 20s 6ms&#x2F;sample - loss: 1.3169 - acc: 0.4377 - val_loss: 1.0855 - val_acc: 0.5615</span><br><span class="line">Epoch 2&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 19s 6ms&#x2F;sample - loss: 1.0262 - acc: 0.5910 - val_loss: 0.9683 - val_acc: 0.6161</span><br><span class="line">Epoch 3&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.8734 - acc: 0.6678 - val_loss: 0.9812 - val_acc: 0.6383</span><br><span class="line">Epoch 4&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.7239 - acc: 0.7304 - val_loss: 0.9805 - val_acc: 0.6494</span><br><span class="line">Epoch 5&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.5176 - acc: 0.8091 - val_loss: 1.0303 - val_acc: 0.6485</span><br><span class="line">Epoch 6&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.3354 - acc: 0.8831 - val_loss: 1.3695 - val_acc: 0.6475</span><br><span class="line">Epoch 7&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.2050 - acc: 0.9300 - val_loss: 1.7195 - val_acc: 0.6263</span><br><span class="line">Epoch 8&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.1331 - acc: 0.9562 - val_loss: 2.0495 - val_acc: 0.6263</span><br><span class="line">Epoch 9&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.0754 - acc: 0.9790 - val_loss: 2.1570 - val_acc: 0.6401</span><br><span class="line">Epoch 10&#x2F;10</span><br><span class="line">3242&#x2F;3242 [&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;] - 18s 6ms&#x2F;sample - loss: 0.0620 - acc: 0.9809 - val_loss: 2.2967 - val_acc: 0.6244</span><br></pre></td></tr></table></figure>
<p>是不是有看到叫<code>val_acc</code>的地方？在訓練時<code>val_acc</code>不會出現，訓練完一輪後才會出現，它提供這個模型訓練完成後實際上的正確效果，平常我們只看<code>acc</code>是不太準的，因為它只評估這些訓練資料我讀熟了沒，是不是能完全分類正確這些訓練資料。以人的生活行為來比喻的話，有點像應付考試而去背完所有的重點，也許那場考試你拿到很高分，但是下次同樣主題但不同題型考試時，就不一定會拿到這麼高分了。而這時候驗證資料就會是一個很好的參考點，可以評估這個模型是否overfitting，或是還有繼續訓練的空間，亦或是建立的模型是不是不適合等…..</p>
<h3 id="延伸部分"><a href="#延伸部分" class="headerlink" title="延伸部分"></a>延伸部分</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot_learning_curves</span><span class="params">(History)</span>:</span></span><br><span class="line">    pd.DataFrame(History.history).plot(figsize=(<span class="number">8</span>,<span class="number">5</span>))</span><br><span class="line">    plt.grid(<span class="literal">True</span>)</span><br><span class="line">    plt.gca().set_ylim(<span class="number">0</span>,<span class="number">1</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    </span><br><span class="line">plot_learning_curves(History)</span><br></pre></td></tr></table></figure>
<p>覺得看數字去評估訓練結果不舒服嗎？可不可以用圖片呈現模型的訓練狀況？<br>恭喜你！這個部分就是教你做圖片呈現的應用。<br>在網路上查，應該很多都會叫你用上tensorboard，這個解答算對拉！畢竟tensorboard比較詳細。<br>但這次要教的，不用tensorboard就可以達到模型評估的情形。同樣都能達到評估效果，何必再多花心思去搞tensorboard呢？<br>這次會用到pandas這個函式庫。<br>然後函式照我<code>plot_learning_curves</code>寫上去就好了，這樣就會幫你畫出來了。<br>output：</p>
<img src="/2020/09/24/%E6%B7%B1%E5%BA%A6%E5%AD%B8%E7%BF%92%E5%AF%A6%E4%BD%9C%E5%BF%83%E5%BE%9701-%E8%8A%B1%E5%93%81%E7%A8%AE%E8%BE%A8%E8%AD%98/pc03.JPG" class="" title="This is an image">

<p>提醒一下！History是訓練時我有事先宣告的變數，是紀錄每次訓練的情形用的，目的也是為了做畫圖而去宣告的。</p>
<h2 id="結尾"><a href="#結尾" class="headerlink" title="結尾"></a>結尾</h2><p>這次的實作心得就告一段落了。不難吧？真的就是範例程式的變化而已，個人認為難在資料處理，因為這是一個全新的東西，沒有基礎概念會很難下手，而且不是每個人都有這個概念，像我就是，第一次學的時候我完全不知道從何下手，即使我知道簡單的模型要怎麼建，但不會讓資料處理就完全沒有發揮的地方，所以第二集會非常focus在資料要怎麼處理，也希望這樣有幫助到大家。下一集沒意外就是補充這篇文章沒有說明的CNN，這是一個很重要的一章，希望我的文筆能夠清楚表達CNN是什麼lol</p>


      

    </section>
    
      <section class='ArticleMeta'>
          <div>
            发布于&nbsp;
            <time datetime="2020-09-24T07:54:00.000Z" itemprop="datePublished">
              2020-09-24
            </time>
          </div>
          
            <div>
              tags: 
  <li class="meta-text">
  { <a href="/tags/%E5%AF%A6%E4%BD%9C%E5%BF%83%E5%BE%97/">實作心得</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/jupyter-notebook/">jupyter notebook</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Tensorflow/">Tensorflow</a> }
  </li>

  <li class="meta-text">
  { <a href="/tags/Deep-Learning/">Deep Learning</a> }
  </li>


            </div>
          
      </section>
    
    
</article>

  
</div>

            <footer>
    <div>© 2020 - daniel chen </div>
    <div>
        <span>
            Powered by <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>
        </span>
        ,
        <span>
            Theme - <a href="https://github.com/nameoverflow/hexo-theme-icalm" target="_blank" rel="noopener">Icalm</a>
        </span>
    </div>
</footer>

        </div>
    </div>
</div>

<script src="/js/pager/dist/singlepager.js"></script>

<script>
var sp = new Pager('data-pager-shell')

</script>
</body>
</html>